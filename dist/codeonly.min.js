function e(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}function t(e){return e instanceof Function&&!!e.prototype&&!!e.prototype.constructor}let n,i=/^[a-zA-Z$][a-zA-Z0-9_$]*$/;function o(e){return e.match(i)?`.${e}`:`[${JSON.stringify(e)}]`}function s(e,t){e.loading?e.addEventListener("loaded",t,{once:!0}):t()}class r extends EventTarget{constructor(){super(),this.browser=!1,this.ssr=!1}#e=0;enterLoading(){this.#e++,1==this.#e&&this.dispatchEvent(new Event("loading"))}leaveLoading(){this.#e--,0==this.#e&&this.dispatchEvent(new Event("loaded"))}get loading(){return 0!=this.#e}async load(e){this.enterLoading();try{return await e()}finally{this.leaveLoading()}}untilLoaded(){return e=this,new Promise((t=>s(e,t)));var e}}function a(e){n=e}Object.defineProperty(globalThis,"coenv",{get:()=>n()});class l{constructor(e){this.html=e}html;static areEqual(e,t){return e instanceof l&&t instanceof l&&e.html==t.html}}function d(e){return e instanceof Function?(...t)=>new l(e(...t)):new l(e)}class h{constructor(e){this.value=e}}function c(e){return new h(e)}class u{static declare(e){coenv.declareStyle(e)}}function m(e,t){let n="";for(let i=0;i<e.length-1;i++)n+=e[i],n+=t[i];n+=e[e.length-1],u.declare(n)}let p=[],f=!1;function g(e,t){e&&(0!=(t=t??0)&&(f=!0),p.push({callback:e,order:t}),1==p.length&&coenv.window.requestAnimationFrame((function(){let e=p;f&&(e.sort(((e,t)=>t.order-e.order)),f=!1),p=[];for(let t=e.length-1;t>=0;t--)e[t].callback()})))}function v(e){0==p.length?e():g(e,Number.MAX_SAFE_INTEGER)}function y(){return 0!=p.length}function w(){let e=[],t="",n=!0;function i(...i){for(let o=0;o<i.length;o++){let s=i[o];s.lines?e.push(...s.lines.map((e=>t+e))):Array.isArray(s)?e.push(...s.filter((e=>null!=e)).map((e=>t+e))):n?e.push(...s.split("\n").map((e=>t+e))):e.push(t+s)}}function o(){t+="  "}function s(){t=t.substring(2)}return{append:i,indent:o,unindent:s,braced:function(e){i("{"),o(),e(this),s(),i("}")},toString:function(){return e.join("\n")+"\n"},lines:e,enableSplit(e){n=e},get isEmpty(){return 0==e.length}}}class ${constructor(){this.code=w(),this.code.closure=this,this.functions=[],this.locals=[],this.prologs=[],this.epilogs=[]}get isEmpty(){return this.code.isEmpty&&0==this.locals.length&&this.functions.every((e=>e.code.isEmpty))&&this.prologs.every((e=>e.isEmpty))&&this.epilogs.every((e=>e.isEmpty))}addProlog(){let e=w();return this.prologs.push(e),e}addEpilog(){let e=w();return this.epilogs.push(e),e}addLocal(e,t){this.locals.push({name:e,init:t})}addFunction(e,t){t||(t=[]);let n={name:e,args:t,code:new $};return this.functions.push(n),n.code}getFunction(e){return this.functions.find((t=>t.name==e))?.code}toString(){let e=w();return this.appendTo(e),e.toString()}appendTo(e){this.locals.length>0&&e.append(`let ${this.locals.map((e=>e.init?`${e.name} = ${e.init}`:e.name)).join(", ")};`);for(let t of this.prologs)e.append(t);e.append(this.code);for(let t of this.functions)e.append(`function ${t.name}(${t.args.join(", ")})`),e.append("{"),e.indent(),t.code.appendTo(e),e.unindent(),e.append("}");for(let t of this.epilogs)e.append(t)}}function b(e){return null==e?"":(""+e).replace(/["'&<>]/g,(function(e){switch(e){case'"':return"&quot;";case"&":return"&amp;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;"}}))}function x(e){let t,n,i,o,s,r,a,l=e.event??"input",d=e.parse??(e=>e),h=e.format??(e=>e);if("string"==typeof e&&(e={prop:e}),e.get&&e.set)i=()=>e.get(n.model,n),o=t=>e.set(n.model,t,n);else{if("string"!=typeof e.prop)throw new Error("Invalid input binding");{let u;u=e.target instanceof Function?()=>e.target(n.model,n):e.target?()=>e.target:()=>n.model;let m=e.prop.split("."),p=m.pop();function f(){let e=u();for(let t=0;t<m.length;t++)e=e[m[t]];return e}i=()=>f()[p],o=e=>f()[p]=e}}function c(i){let s=r(t[a]);void 0!==s&&(s=d(s)),void 0!==s&&o(s),e.on_change?.(n.model,i)}return{create:function(e,i){if(t=e,n=i,a="value",s=e=>e,r=e=>e,"INPUT"==t.tagName){let e=t.getAttribute("type").toLowerCase();"checkbox"==e?(a="checked",r=e=>!!e):"radio"==e&&(a="checked",r=e=>e?t.getAttribute("value"):void 0,s=e=>t.getAttribute("value")==e||void 0)}else"SELECT"==t.tagName&&t.hasAttribute("multiple")&&(a="selectedOptions",r=e=>Array.from(e).map((e=>e.value)),s=e=>{Array.from(t.options).forEach((t=>{t.selected=e.indexOf(t.value)>=0}))});t.addEventListener(l,c)},update:function(){let e=h(i());void 0!==e&&(e=s(e)),void 0!==e&&(t[a]=e)},destroy:function(){t.removeEventListener(l,c),t=null}}}class N{static rawText(e){return e instanceof l?e.html:b(e)}static renderToString(e){let t="";return e({write:function(e){t+=e}}),t}static renderComponentToString(e){let t="";return e.render({write:function(e){t+=e}}),t}static rawStyle(e){let t;return t=e instanceof l?e.html:b(e),t=t.trim(),t.endsWith(";")||(t+=";"),t}static rawNamedStyle(e,t){if(!t)return"";let n;return n=t instanceof l?t.html:b(t),n=n.trim(),n+=";",`${e}:${n}`}static createTextNode(e){if(e instanceof l){let t=document.createElement("SPAN");return t.innerHTML=e.html,t}return document.createTextNode(e)}static setElementAttribute(e,t,n){void 0===n?e.removeAttribute(t):e.setAttribute(t,n)}static setElementText(e,t){t instanceof l?e.innerHTML=t.html:e.textContent=t}static setNodeText(e,t){if(t instanceof l){if(1==e.nodeType)return e.innerHTML=t.html,e;let n=document.createElement("SPAN");return n.innerHTML=t.html,e.replaceWith(n),n}{if(3==e.nodeType)return e.nodeValue=t,e;let n=document.createTextNode(t);return e.replaceWith(n),n}}static setNodeClass(e,t,n){n?e.classList.add(t):e.classList.remove(t)}static setNodeStyle(e,t,n){null==n?e.style.removeProperty(t):e.style[t]=n}static boolClassMgr(e,t,n,i){let o,s=null;return function(){let r=i(e.model,e);r!=o&&(o=r,i.withTransition&&t.isConnected?(s?.finish(),s=i.withTransition(e),r?(s.enterNodes([t]),s.onWillEnter((()=>t.classList.add(n)))):(s.leaveNodes([t]),s.onDidLeave((()=>t.classList.remove(n)))),s.start()):N.setNodeClass(t,n,r))}}static setNodeDisplay(e,t,n){if(!0!==t){if(!1===t||null==t){let t=e.style.display;return"none"!=e.style.display&&(e.style.display="none"),t??null}if("string"==typeof t){let n=e.style.display;return e.style.display!=t&&(e.style.display=t),n??null}}else null===n?e.style.removeProperty("display"):void 0!==n&&e.style.display!=n&&(e.style.display=n)}static displayMgr(e,t,n){let i,o,s=null;return function(){let r=n(e.model,e);if(r!=i){if(i=r,n.withTransition&&t.isConnected){s?.finish();let i,a=window.getComputedStyle(t).getPropertyValue("display");if(i=!0===r?o:!1===r||null==r?"none":r,"none"==a!=("none"==i))return s=n.withTransition(e),"none"!=i?(s.enterNodes([t]),s.onWillEnter((()=>o=N.setNodeDisplay(t,r,o)))):(s.leaveNodes([t]),s.onDidLeave((()=>o=N.setNodeDisplay(t,r,o)))),void s.start()}o=N.setNodeDisplay(t,r,o)}}}static replaceMany(e,t){if(e?.[0]?.parentNode){e[0].replaceWith(...t);for(let t=1;t<e.length;t++)e[t].remove()}}static addEventListener(e,t,n,i){function o(t){return i(e(),t)}return t.addEventListener(n,o),function(){t.removeEventListener(n,o)}}static input(){return x(...arguments)}}class S{static plugins=[];static register(e){this.plugins.push(e)}static transform(e){for(let t of this.plugins)t.transform&&(e=t.transform(e));return e}static transformGroup(e){for(let t of this.plugins)t.transformGroup&&(e=t.transformGroup(e));return e}}class _{constructor(e){if(e.$node&&(e=e.$node),Array.isArray(e)?e={$:e}:"object"!=typeof e||e instanceof l||(e=Object.assign({},e)),"string"==typeof e.type&&"#"!=e.type[0]&&Object.assign(e,function(e){let t=e.match(/\s*([^ \t.#]*)/);if(!t)return{};e=e.substring(t[0].length);let n=[],i={type:t[1]};for(let t of e.matchAll(/\s*([.#]?)([^ \t=.#]+)(?:\s*=\s*(\'[^']+\'|\S+))?/g)){if(!t[3]){if("."==t[1]){n.push(t[2]);continue}if("#"==t[1]){i.id=t[2];continue}}let e=t[2];"type"==e&&(e="attr_type");let o=t[3]??t[2];(o.startsWith("'")&&o.endsWith("'")||o.startsWith('"')&&o.endsWith('"'))&&(o=o.substring(1,o.length-1)),i[e]=o}return n.length>0&&(i.class=n.join(" ")),i}(e.type)),t(e=S.transform(e))&&(e={type:e}),this.template=e,t(e.type))e.type.integrate?this.kind="integrated":this.kind="component";else if("string"==typeof e)this.kind="text";else if(e instanceof l){if(this.kind="html",this.html=e.html,coenv.document){let t=coenv.document.createElement("div");t.innerHTML=e.html,this.nodes=[...t.childNodes],this.nodes.forEach((e=>e.remove()))}}else e instanceof Function?this.kind="dynamic_text":"#comment"===e.type?this.kind="comment":void 0===e.type?this.kind="fragment":this.kind="element";if("integrated"===this.kind&&(e.$&&!e.content&&(e.content=e.$,delete e.$),this.integrated=this.template.type.integrate(this.template)),"element"==this.kind&&e.$&&!e.text&&("string"==typeof e.$||e.$ instanceof l)&&(e.text=e.$,delete e.$),"element"==this.kind||"fragment"==this.kind)e.$&&!e.childNodes&&(e.childNodes=e.$,delete e.$),e.childNodes?(Array.isArray(e.childNodes)?e.childNodes=e.childNodes.flat():e.childNodes=[e.childNodes],e.childNodes=e.childNodes.map((e=>e.$node??e)),this.childNodes=S.transformGroup(e.childNodes).map((e=>new _(e)))):this.childNodes=[];else if(this.isComponent)e.$&&!e.content&&(e.content=e.$,delete e.$);else if(e.childNodes)throw new Error("childNodes only supported on element and fragment nodes")}get isSingleRoot(){return this.isFragment?1==this.childNodes.length&&this.childNodes[0].isSingleRoot:this.isComponent?this.template.type.isSingleRoot:this.isIntegrated?this.integrated.isSingleRoot:"html"!=this.kind||1==this.nodes.length}get isComponent(){return"component"===this.kind}get isFragment(){return"fragment"===this.kind}get isIntegrated(){return"integrated"===this.kind}*enumLocalNodes(){if(this.isFragment||(yield this),this.childNodes)for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumLocalNodes()}spreadChildDomNodes(){return Array.from(function*(e){for(let t=0;t<e.childNodes.length;t++)yield e.childNodes[t].spreadDomNodes()}(this)).filter((e=>e.length>0)).join(", ")}spreadDomNodes(){return Array.from(this.enumAllNodes()).join(", ")}*enumAllNodes(){switch(this.kind){case"fragment":for(let e=0;e<this.childNodes.length;e++)yield*this.childNodes[e].enumAllNodes();break;case"component":case"integrated":this.isSingleRoot?yield`${this.name}.rootNode`:yield`...${this.name}.rootNodes`;break;case"html":this.nodes.length>0&&(this.nodes.length>1?yield`...${this.name}`:yield`${this.name}`);break;default:yield this.name}}}let E={enterNodes:function(){},leaveNodes:function(){},onWillEnter:function(e){e()},onDidLeave:function(e){e()},start:function(){},finish:function(){}};class L{static integrate(e){let t=null;e.content&&"object"==typeof e.content&&(t=e.content,delete e.content);let n={isSingleRoot:!1,data:{ownsContent:e.ownsContent??!0,content:e.content},nodes:[t?new _(t):null,e.placeholder?new _(e.placeholder):null]};return delete e.content,delete e.placeholder,delete e.ownsContent,n}static transform(e){return e instanceof Function&&!t(e)?{type:L,content:e}:("embed-slot"==e.type&&(e.type=L),e)}#t;#n;#i;#o;#s;#r;#a;#l;constructor(e){this.#t=e.context,this.#a=e.nodes[1],this.#s=coenv.document?.createTextNode(""),this.#r=coenv.document?.createTextNode(""),this.#d=e.data.ownsContent??!0,e.nodes[0]?this.content=e.nodes[0]():this.content=e.data.content}get#h(){return this.#o?.rootNodes??this.#o??[]}get rootNodes(){return[this.#s,...this.#h,this.#r]}get isSingleRoot(){return!1}#d=!0;get ownsContent(){return this.#d}set ownsContent(e){this.#d=e}get content(){return this.#n}set content(e){this.#n=e,this.#n instanceof Function?this.replaceContent(this.#n.call(this.#t.model,this.#t.model,this.#t)):this.replaceContent(this.#n)}update(){this.#n instanceof Function&&this.replaceContent(this.#n.call(this.#t.model,this.#t.model,this.#t)),this.#i||this.#o?.update?.()}bind(){this.#i||this.#o?.bind?.()}unbind(){this.#i||this.#o?.unbind?.()}get isAttached(){}get#c(){return null!=this.#s?.parentNode}#u;setMounted(e){this.#u=e,this.#o?.setMounted?.(e)}replaceContent(e){if((this.#i===e||l.areEqual(this.#i,e))&&(e||this.#o))return;let t,n=this.#o,i=[...this.#h];if(this.#i=e,e)if(e.rootNodes)t=e;else if(e instanceof l){let n=coenv.document.createElement("span");n.innerHTML=e.html,t=[...n.childNodes],t.forEach((e=>e.remove()))}else if("string"==typeof e)t=[coenv.document.createTextNode(e)];else if(Array.isArray(e))t=e;else if(void 0!==e.nodeType)t=[e];else{if(!e.render)throw new Error("Embed slot requires component, array of HTML nodes or a single HTML node");t=e}else t=this.#a?.(this.#t)??null;if(this.#o=t,this.#c){let e;this.#l?.finish(),this.#u&&(e=this.#n?.withTransition?.(this.#t)),e||(e=E),this.#l=e,e.enterNodes(this.#h),e.leaveNodes(i),e.onWillEnter((()=>{this.#r.before(...this.#h),this.#u&&this.#o?.setMounted?.(!0)})),e.onDidLeave((()=>{i.forEach((e=>e.remove())),this.#u&&n?.setMounted?.(!1),this.#d&&n?.destroy?.()})),e.start()}else this.#u&&(n?.setMounted?.(!1),this.#o?.setMounted?.(!0)),this.#d&&n?.destroy?.()}destroy(){this.#d&&this.#o?.destroy?.()}}S.register(L);class T{constructor(){}#m=new Map;add(e,t){let n=this.#m.get(e);n?n.push(t):this.#m.set(e,[t])}delete(e,t){let n=this.#m.get(e);if(n){let e=n.indexOf(t);if(e>=0)return void n.splice(e,1)}throw new Error("key/value pair not found")}consume(e){let t=this.#m.get(e);if(t&&0!=t.length)return t.shift()}has(e){return this.#m.has(e)}}class C{static integrate(e){let t,n=e.template,i={template:{items:e.items,condition:e.condition,itemKey:e.itemKey}};return e.empty&&(t=[new _(e.empty)]),delete e.template,delete e.items,delete e.condition,delete e.itemKey,delete e.empty,{isSingleRoot:!1,data:i,nodes:t,compile:e=>{i.itemConstructor=e.compileTemplate(n,e)}}}static transform(e){if(void 0===e.foreach)return e;let t;return e.foreach instanceof Function||Array.isArray(e.foreach)?(t={type:C,template:e,items:e.foreach},delete e.foreach):(t=Object.assign({},e.foreach,{type:C,template:e}),delete e.foreach),t}constructor(e){this.itemConstructor=e.data.itemConstructor,this.outer=e.context,this.items=e.data.template.items,this.condition=e.data.template.condition,this.itemKey=e.data.template.itemKey,this.emptyConstructor=e.nodes.length?e.nodes[0]:null,this.itemDoms=[],this.#s=coenv.document?.createComment(" enter foreach block "),this.#r=coenv.document?.createComment(" leave foreach block "),this.itemConstructor.isSingleRoot?(this.#p=this.#f,this.#g=this.#v,this.#y=this.#w,this.#$=this.#b):(this.#p=this.#x,this.#g=this.#N,this.#y=this.#S,this.#$=this.#_)}get rootNodes(){let e=this.emptyDom?this.emptyDom.rootNodes:[];if(this.itemConstructor.isSingleRoot)return[this.#s,...this.itemDoms.map((e=>e.rootNode)),...e,this.#r];{let t=[this.#s];for(let e=0;e<this.itemDoms.length;e++)t.push(...this.itemDoms[e].rootNodes);return t.push(...e),t.push(this.#r),t}}#s;#r;#u=!1;setMounted(e){this.#u=e,k(this.itemDoms,e)}update(){let e;e=this.items instanceof Function?this.items.call(this.outer.model,this.outer.model,this.outer):this.items,e=e??[];let t={outer:this.outer},n=null;if(this.condition&&(e=e.filter((e=>(t.model=e,this.condition.call(e,e,t))))),this.itemKey&&(n=e.map((e=>(t.model=e,this.itemKey.call(e,e,t))))),!this.itemsLoaded)return this.itemsLoaded=!0,this.#p(e,n,0,0,e.length),void this.#E();this.#L(0,this.itemDoms.length,e,n)}#L(e,t,n,i){let o,s,r=e+t;if(o=0==e&&t==this.itemDoms.length?this.itemDoms:this.itemDoms.slice(e,r),s=i?function(e,t){let n=Math.min(e.length,t.length),i=Math.max(e.length,t.length),o=0;for(;o<n&&e[o]==t[o];)o++;if(o==i)return[];if(o==e.length)return[{op:"insert",index:e.length,count:t.length-e.length}];let s=0;for(;s<n-o&&e[e.length-s-1]==t[t.length-s-1];)s++;if(s==e.length)return[{op:"insert",index:0,count:t.length-e.length}];if(o+s==e.length)return[{op:"insert",index:o,count:t.length-e.length}];if(o+s==t.length)return[{op:"delete",index:o,count:e.length-t.length}];let r=e.length-s,a=t.length-s,l=f(t,o,a),d=null,h=[],c=o,u=o;for(;c<a;){for(;c<a&&e[u]==t[c];)l.delete(t[c],c),c++,u++;let n=c,i=u;for(;u<r&&!l.has(e[u]);)u++;if(u>i)h.push({op:"delete",index:n,count:u-i});else{for(d||(d=f(e,c,r));c<a&&!d.has(t[c]);)l.delete(t[c],c),c++;if(!(c>n))break;h.push({op:"insert",index:n,count:c-n})}}if(c==a)return h;let m=0,p=new T;for(;u<r;){let t=u;for(;u<r&&!l.has(e[u]);)u++;if(u>t)h.push({op:"delete",index:c,count:u-t});else{for(;u<r&&void 0!==l.consume(e[u]);)p.add(e[u],m++),u++;u>t&&h.push({op:"store",index:c,count:u-t})}}for(;c<a;){let e=c;for(;c<a&&!p.has(t[c]);)c++;if(c>e){h.push({op:"insert",index:e,count:c-e});continue}let n={op:"restore",index:c,count:0};for(h.push(n);c<a;){let e=p.consume(t[c]);if(void 0===e)break;0==n.count?(n.storeIndex=e,n.count=1):n.storeIndex+n.count==e?n.count++:(n={op:"restore",index:c,storeIndex:e,count:1},h.push(n)),c++}}return h;function f(e,t,n){let i=new T;for(let o=t;o<n;o++)i.add(e[o],o);return i}}(o.map((e=>e.context.key)),i):n.length>o.length?[{op:"insert",index:o.length,count:n.length-o.length}]:n.length<o.length?[{op:"delete",index:n.length,count:o.length-n.length}]:[],0==s.length)return void this.#T(n,i,e,0,t);let a=[],l=[],d={insert:function(t){h+=t.count;let o=Math.min(l.length,t.count);if(o){let s=l.splice(0,o);this.#y(t.index+e,s),this.#T(n,i,t.index+e,t.index,o),this.#u&&k(s,!0)}o<t.count&&this.#p(n,i,t.index+e+o,t.index+o,t.count-o)},delete:function(t){let n=this.#$(t.index+e,t.count);this.#u&&k(n,!1);l.push(...n)},store:function(t){a.push(...this.#$(t.index+e,t.count))},restore:function(t){h+=t.count,this.#y(t.index+e,a.slice(t.storeIndex,t.storeIndex+t.count)),this.#T(n,i,t.index+e,t.index,t.count)}},h=0;for(let t of s)t.index>h&&(this.#T(n,i,e+h,h,t.index-h),h=t.index),d[t.op].call(this,t);h<n.length&&this.#T(n,i,e+h,h,n.length-h),M(l),this.#E()}bind(){this.emptyDom?.bind?.()}unbind(){this.emptyDom?.unbind?.()}destroy(){M(this.itemDoms),this.itemDoms=null}#E(){if(0==this.itemDoms.length)!this.emptyDom&&this.emptyConstructor&&(this.emptyDom=this.emptyConstructor(),this.#c&&this.#r.before(...this.emptyDom.rootNodes),this.#u&&this.emptyDom.setMounted(!0)),this.emptyDom&&this.emptyDom.update();else if(this.emptyDom){if(this.#c)for(var e of this.emptyDom.rootNodes)e.remove();this.#u&&this.emptyDom.setMounted(!1),this.emptyDom.destroy(),this.emptyDom=null}}#p;#y;#g;#$;get#c(){return null!=this.#r?.parentNode}#x(e,t,n,i,o){let s=[];for(let r=0;r<o;r++){let o={outer:this.outer,model:e[i+r],key:t?.[i+r],index:n+r};s.push(this.itemConstructor(o))}this.#S(n,s),this.#u&&k(s,!0)}#S(e,t){if(this.itemDoms.splice(e,0,...t),this.#c){let n,i=[];t.forEach((e=>i.push(...e.rootNodes))),n=e+t.length<this.itemDoms.length?this.itemDoms[e+t.length].rootNodes[0]:this.#r,n.before(...i)}}#N(e,t){let n=this.#_(e,t);this.#u&&k(n,!1),M(n)}#_(e,t){if(this.#c)for(let n=0;n<t;n++){let t=this.itemDoms[e+n].rootNodes;for(let e=0;e<t.length;e++)t[e].remove()}return this.itemDoms.splice(e,t)}#f(e,t,n,i,o){let s=[];for(let r=0;r<o;r++){let o={outer:this.outer,model:e[i+r],key:t?.[i+r],index:n+r};s.push(this.itemConstructor(o))}this.#w(n,s),this.#u&&k(s,!0)}#w(e,t){if(this.itemDoms.splice(e,0,...t),this.#c){let n,i=t.map((e=>e.rootNode));n=e+t.length<this.itemDoms.length?this.itemDoms[e+t.length].rootNode:this.#r,n.before(...i)}}#v(e,t){let n=this.#b(e,t);this.#u&&k(n,!1),M(n)}#b(e,t){if(this.#c)for(let n=0;n<t;n++)this.itemDoms[e+n].rootNode.remove();return this.itemDoms.splice(e,t)}#T(e,t,n,i,o){for(let s=0;s<o;s++){let o=this.itemDoms[n+s];o.context.key=t?.[i+s],o.context.index=n+s,o.context.model=e[i+s],o.rebind(),o.update()}}}function M(e){for(let t=e.length-1;t>=0;t--)e[t].destroy()}function k(e,t){for(let n=e.length-1;n>=0;n--)e[n].setMounted(t)}function R(e){let t=function(){let t=coenv.document?.createComment(e);return{get rootNode(){return t},get rootNodes(){return[t]},get isSingleRoot(){return!0},setMounted(e){},destroy(){},update(){}}};return t.isSingleRoot=!0,t}S.register(C);class A{static integrate(e){let t=[],n=e.key;delete e.key;let i=[],o=!1,s=!0;for(let n=0;n<e.branches.length;n++){let r=e.branches[n],a={};if(t.push(a),r.condition instanceof Function?(a.condition=r.condition,o=!1):void 0!==r.condition?(a.condition=()=>r.condition,o=!!r.condition):(a.condition=()=>!0,o=!0),void 0!==r.template){let e=new _(r.template);e.isSingleRoot||(s=!1),a.nodeIndex=i.length,i.push(e)}}return delete e.branches,o||t.push({condition:()=>!0}),{isSingleRoot:s,nodes:i,data:{key:n,branches:t,isSingleRoot:s}}}static transform(e){if(void 0!==e.key){let t=e.key;if(!(t instanceof Function))throw new Error("`key` is not a function");return delete e.key,{type:A,key:t,branches:[{template:this.transform(e),condition:!0}]}}if(void 0!==e.if){let t={type:A,branches:[{template:e,condition:e.if}]};return delete e.if,t}return e}static transformGroup(e){let t=null,n=!1;for(let i=0;i<e.length;i++){let o=e[i];if(o.if)n||(e=[...e],n=!0),o=Object.assign({},o),t={type:A,branches:[{condition:o.if,template:o}]},delete o.if,e.splice(i,1,t);else if(o.elseif){if(!t)throw new Error("template has 'elseif' without a preceeding condition");o=Object.assign({},o),t.branches.push({condition:o.elseif,template:o}),delete o.elseif,e.splice(i,1),i--}else if(void 0!==o.else){if(!t)throw new Error("template has 'else' without a preceeding condition");o=Object.assign({},o),t.branches.push({condition:!0,template:o}),delete o.else,t=null,e.splice(i,1),i--}else t=null}return e}constructor(e){this.isSingleRoot=e.data.isSingleRoot,this.branches=e.data.branches,this.key=e.data.key,this.branch_constructors=[],this.context=e.context;for(let t of this.branches)void 0!==t.nodeIndex?this.branch_constructors.push(e.nodes[t.nodeIndex]):this.branch_constructors.push(R(" IfBlock placeholder "));this.activeBranchIndex=-1,this.activeKey=void 0,this.activeBranch=R(" IfBlock placeholder ")(),this.isSingleRoot||(this.headSentinal=coenv.document?.createComment(" if "))}destroy(){this.activeBranch.destroy()}update(){this.switchActiveBranch(),this.activeBranch.update()}unbind(){this.activeBranch.unbind?.()}bind(){this.activeBranch.bind?.()}get isAttached(){return this.isSingleRoot?null!=this.activeBranch.rootNode?.parentNode:null!=this.headSentinal.parentNode}switchActiveBranch(){let e=this.resolveActiveBranch(),t=this.key?this.key.call(this.context.model,this.context.model,this.context):void 0;if(e!=this.activeBranchIndex||t!=this.activeKey){this.#l?.finish();let n=this.isAttached,i=this.activeBranch;if(this.activeBranchIndex=e,this.activeKey=t,this.activeBranch=this.branch_constructors[e](),n){let e;this.#u&&(e=this.key?this.key.withTransition?.(this.context):this.branches[0].condition.withTransition?.(this.context)),e||(e=E),this.#l=e,e.enterNodes(this.activeBranch.rootNodes),e.leaveNodes(i.rootNodes),e.onWillEnter((()=>{if(this.isSingleRoot){i.rootNodes[i.rootNodes.length-1].after(this.activeBranch.rootNodes[0])}else this.headSentinal.after(...this.activeBranch.rootNodes);this.#u&&this.activeBranch.setMounted(!0)})),e.onDidLeave((()=>{i.rootNodes.forEach((e=>e.remove())),this.#u&&i.setMounted(!1),i.destroy()})),e.start()}else this.#u&&(this.activeBranch.setMounted(!0),i.setMounted(!1),i.destroy())}}#l;resolveActiveBranch(){for(let e=0;e<this.branches.length;e++)if(this.branches[e].condition.call(this.context.model,this.context.model,this.context))return e;throw new Error("internal error, IfBlock didn't resolve to a branch")}#u=!1;setMounted(e){this.#u=e,this.activeBranch.setMounted(e)}get rootNodes(){return this.isSingleRoot?this.activeBranch.rootNodes:[this.headSentinal,...this.activeBranch.rootNodes]}get rootNode(){return this.activeBranch.rootNode}}S.register(A);let D=1;function O(t,n){n||(n={});let i=function(t,n){let i=1,s=1,r=[],a=null,d=new _(t),c=new Map,u=function t(u,m){let p,f={emit_text_node:function(e){M(e),E(`${e.name} = document.createTextNode(${JSON.stringify(e.template)});`)},emit_html_node:function(e){0!=e.nodes.length&&(M(e),1==e.nodes.length?(E(`${e.name} = refs[${r.length}].cloneNode(true);`),r.push(e.nodes[0])):(E(`${e.name} = refs[${r.length}].map(x => x.cloneNode(true));`),r.push(e.nodes)))},emit_dynamic_text_node:function(e){M(e);let t="p"+s++;g.addLocal(t),E(`${e.name} = helpers.createTextNode("");`),k(),L(`temp = ${F(r.length)};`),L(`if (temp !== ${t})`),L(`  ${e.name} = helpers.setNodeText(${e.name}, ${t} = ${F(r.length)});`),r.push(e.template)},emit_comment_node:function(e){if(M(e),e.template.text instanceof Function){let t="p"+s++;g.addLocal(t),E(`${e.name} = document.createComment("");`),k(),L(`temp = ${F(r.length)};`),L(`if (temp !== ${t})`),L(`  ${e.name}.nodeValue = ${t} = temp;`),r.push(e.template.text)}else E(`${e.name} = document.createComment(${JSON.stringify(e.template.text)});`)},emit_fragment_node:function(e){D(e)},emit_element_node:function(t){let i=n.xmlns,o=t.template.xmlns;void 0===o&&"svg"==t.template.type&&(o="http://www.w3.org/2000/svg"),null==o&&(o=n.xmlns),M(t),o?(n.xmlns=o,E(`${t.name} = document.createElementNS(${JSON.stringify(o)}, ${JSON.stringify(t.template.type)});`)):E(`${t.name} = document.createElement(${JSON.stringify(t.template.type)});`),S.append(`${t.name} = null;`);for(let i of Object.keys(t.template)){if(O(t,i))continue;if(i.startsWith("class_")){let n=e(i.substring(6)),o=t.template[i];if(o instanceof Function){t.bcCount||(t.bcCount=0);let e=`${t.name}_bc${t.bcCount++}`;g.addLocal(e),E(`${e} = helpers.boolClassMgr(context, ${t.name}, ${JSON.stringify(n)}, refs[${r.length}]);`),r.push(o),L(`${e}();`)}else E(`helpers.setNodeClass(${t.name}, ${JSON.stringify(n)}, ${o});`);continue}if(i.startsWith("style_")){let n=e(i.substring(6));j(t.template[i],(e=>`helpers.setNodeStyle(${t.name}, ${JSON.stringify(n)}, ${e})`));continue}if("display"==i){if(t.template.display instanceof Function){let e=`${t.name}_dm`;g.addLocal(e),E(`${e} = helpers.displayMgr(context, ${t.name}, refs[${r.length}]);`),r.push(t.template.display),L(`${e}();`)}else E(`helpers.setNodeDisplay(${t.name}, ${JSON.stringify(t.template.display)});`);continue}if("text"==i){t.template.text instanceof Function?j(t.template.text,(e=>`helpers.setElementText(${t.name}, ${e})`)):t.template.text instanceof l&&E(`${t.name}.innerHTML = ${JSON.stringify(t.template.text.html)};`),"string"==typeof t.template.text&&E(`${t.name}.textContent = ${JSON.stringify(t.template.text)};`);continue}let o=i;i.startsWith("attr_")&&(o=o.substring(5)),n.xmlns||(o=e(o)),j(t.template[i],(e=>`helpers.setElementAttribute(${t.name}, ${JSON.stringify(o)}, ${e})`))}D(t),t.childNodes?.length&&E(`${t.name}.append(${t.spreadChildDomNodes()});`),n.xmlns=i},emit_integrated_node:A,emit_component_node:function(e){M(e),E(`${e.name} = new refs[${r.length}]();`),r.push(e.template.type);let t=new Set(e.template.type.slots??[]);t.size>0&&E(`${e.name}.create?.()`);let n="auto"===e.template.update,i=!1;N.append(`${e.name}.setMounted(mounted);`),S.append(`${e.name}?.destroy();`),S.append(`${e.name} = null;`);for(let a of Object.keys(e.template)){if(O(e,a))continue;if("update"==a)continue;if(t.has(a)){if(void 0===e.template[a])continue;let t=new _(e.template[a]);R(t),t.isSingleRoot?E(`${e.name}${o(a)}.content = ${t.name};`):E(`${e.name}${o(a)}.content = [${t.spreadDomNodes()}];`);continue}let l=typeof e.template[a];if("string"==l||"number"==l||"boolean"==l)E(`${e.name}${o(a)} = ${JSON.stringify(e.template[a])}`);else if("function"===l){n&&!i&&(i=`${e.name}_mod`,L(`let ${i} = false;`));let t="p"+s++;g.addLocal(t);let l=r.length;k(),L(`temp = ${F(l)};`),L(`if (temp !== ${t})`),n&&(L("{"),L(`  ${i} = true;`)),L(`  ${e.name}${o(a)} = ${t} = temp;`),n&&L("}"),r.push(e.template[a])}else{let t=e.template[a];t instanceof h&&(t=t.value),E(`${e.name}${o(a)} = refs[${r.length}];`),r.push(t)}}e.template.update&&("function"==typeof e.template.update?(L(`if (${F(r.length)})`),L(`  ${e.name}.update();`),r.push(e.template.update)):n?i&&(L(`if (${i})`),L(`  ${e.name}.update();`)):L(`${e.name}.update();`))}},g=new $,v=g.addFunction("create").code,y=[],w=g.addFunction("bind").code,b=g.addFunction("update").code,x=g.addFunction("unbind").code,N=g.addFunction("setMounted",["mounted"]).code,S=g.addFunction("destroy").code,E=v.append,L=b.append;m&&(p=g.addFunction("rebind").code);let T=new Map;m&&(a=g,a.code.append("let model = context.model;"),a.code.append("let document = env.document;")),g.code.append("create();"),g.code.append("bind();"),g.code.append("update();"),R(u),E(y),w.closure.isEmpty||(E("bind();"),S.closure.addProlog().append("unbind();"));let C=[];return u.isSingleRoot&&C.push(`  get rootNode() { return ${u.spreadDomNodes()}; },`),m?(C.push("  context,"),u==d&&c.forEach(((e,t)=>C.push(`  get ${t}() { return ${e}; },`))),g.getFunction("bind").isEmpty?p.append("model = context.model"):(p.append("if (model != context.model)"),p.braced((()=>{p.append("unbind();"),p.append("model = context.model"),p.append("bind();")}))),C.push("  rebind,")):(C.push("  bind,"),C.push("  unbind,")),g.code.append(["return { ","  update,","  destroy,","  setMounted,",`  get rootNodes() { return [ ${u.spreadDomNodes()} ]; },`,`  isSingleRoot: ${u.isSingleRoot},`,...C,"};"]),g;function M(e){e.template.export?a.addLocal(e.name):g.addLocal(e.name)}function k(){b.temp_declared||(b.temp_declared=!0,L("let temp;"))}function R(e){e.name="n"+i++,f[`emit_${e.kind}_node`](e)}function A(e){e.integrated.compile?.(n);let o=[],s=!1;if(e.integrated.nodes)for(let n=0;n<e.integrated.nodes.length;n++){let r=e.integrated.nodes[n];if(!r){o.push(null);continue}r.name="n"+i++;let a=t(r,!1);a.getFunction("bind").isEmpty||(s=!0);let l=`${r.name}_constructor_${n+1}`,d=g.addFunction(l,[]);a.appendTo(d.code),o.push(l)}L(`${e.name}.update()`),s&&(w.append(`${e.name}.bind()`),x.append(`${e.name}.unbind()`));let a=-1;e.integrated.data&&(a=r.length,r.push(e.integrated.data)),M(e),E(`${e.name} = new refs[${r.length}]({`,"  context,",`  data: ${e.integrated.data?`refs[${a}]`:"null"},`,`  nodes: [ ${o.join(", ")} ],`,"});"),r.push(e.template.type),N.append(`${e.name}.setMounted(mounted);`),S.append(`${e.name}?.destroy();`),S.append(`${e.name} = null;`);for(let t of Object.keys(e.template))if(!O(e,t))throw new Error(`Unknown element template key: ${t}`)}function D(e){if(e.childNodes)for(let t=0;t<e.childNodes.length;t++)R(e.childNodes[t])}function O(e,t){if(function(e){return"type"==e||"childNodes"==e||"xmlns"==e}(t))return!0;if("export"==t){if("string"!=typeof e.template.export)throw new Error("'export' must be a string");if(c.has(e.template.export))throw new Error(`duplicate export name '${e.template.export}'`);return c.set(e.template.export,e.name),!0}if("bind"==t){if("string"!=typeof e.template.bind)throw new Error("'bind' must be a string");if(T.has(e.template.export))throw new Error(`duplicate bind name '${e.template.bind}'`);return T.set(e.template.bind,!0),w.append(`model${o(e.template.bind)} = ${e.name};`),x.append(`model${o(e.template.bind)} = null;`),!0}if(t.startsWith("on_")){let n=t.substring(3),i=e.template[t];if("string"==typeof i){let e=i;i=(t,...n)=>t[e](...n)}if(!(i instanceof Function))throw new Error(`event handler for '${t}' is not a function`);e.listenerCount||(e.listenerCount=0),e.listenerCount++;let o=`${e.name}_ev${e.listenerCount}`;return g.addLocal(o),E(`${o} = helpers.addEventListener(() => model, ${e.name}, ${JSON.stringify(n)}, refs[${r.length}]);`),r.push(i),S.append(`${o}?.();`),S.append(`${o} = null;`),!0}if("input"==t){let n=`${e.name}_in`;return g.addLocal(n),E(`${n} = helpers.input(refs[${r.length}])`),y.push(`${n}.create(${e.name}, context);`),r.push(e.template[t]),L(`${n}.update()`),S.append(`${n}.destroy()`),!0}return"debug_create"==t?("function"==typeof e.template[t]?(E(`if (${F(r.length)})`),E("  debugger;"),r.push(e.template[t])):e.template[t]&&E("debugger;"),!0):"debug_update"==t?("function"==typeof e.template[t]?(L(`if (${F(r.length)})`),L("  debugger;"),r.push(e.template[t])):e.template[t]&&L("debugger;"),!0):"debug_render"==t}function F(e){return`refs[${e}].call(model, model, context)`}function j(e,t){if(e instanceof Function){let n="p"+s++;g.addLocal(n),t(),k(),L(`temp = ${F(r.length)};`),L(`if (temp !== ${n})`),L(`  ${t(n+" = temp")};`),r.push(e)}else E(t(JSON.stringify(e)))}}(d,!0);return{code:u.toString(),isSingleRoot:d.isSingleRoot,refs:r}}(t,Object.assign({},n,{compileTemplate:O})),s=new Function("env","refs","helpers","context",i.code),r=function(e){return e||(e={}),e.$instanceId=D++,s(coenv,i.refs,N,e??{})};return r.isSingleRoot=i.isSingleRoot,r}class F extends EventTarget{constructor(){super(),this.update=this.update.bind(this),this.invalidate=this.invalidate.bind(this)}static _domTreeConstructor;static get domTreeConstructor(){return this._domTreeConstructor||(this._domTreeConstructor=this.onProvideDomTreeConstructor()),this._domTreeConstructor}static onProvideDomTreeConstructor(){try{return this._compiling=this.onProvideTemplate(),O(this._compiling)}finally{delete this._compiling}}static onProvideTemplate(){return this.template}static get isSingleRoot(){if(!this._compiling)return this.domTreeConstructor.isSingleRoot;return new _(this._compiling).isSingleRoot}create(){this.#C||(this.#C=new this.constructor.domTreeConstructor({model:this}))}get created(){return null!=this.#C}get domTree(){return this.#C||this.create(),this.#C}#C;get isSingleRoot(){return this.domTree.isSingleRoot}get rootNode(){if(!this.isSingleRoot)throw new Error("rootNode property can't be used on multi-root template");return this.domTree.rootNode}get rootNodes(){return this.domTree.rootNodes}static nextFrameOrder=-100;#M=!1;get invalid(){return this.#M}invalidate(){this.#C&&(this.invalid||(this.#M=!0,F.invalidateWorker(this)))}validate(){this.invalid&&this.update()}static _invalidComponents=[];static invalidateWorker(e){this._invalidComponents.push(e),1==this._invalidComponents.length&&g((()=>{for(let e=0;e<this._invalidComponents.length;e++)this._invalidComponents[e].validate();this._invalidComponents=[]}),F.nextFrameOrder)}update(){this.#C&&(this.#M=!1,this.domTree.update())}get loadError(){return this.#k}set loadError(e){this.#k=e,this.invalidate()}#k=null;#e=0;get loading(){return 0!=this.#e}async load(e,t){if(t){let t=await e();return this.invalidate(),t}this.#e++,1==this.#e&&(this.#k=null,this.invalidate(),coenv.enterLoading(),this.dispatchEvent(new Event("loading")));try{return await e()}catch(e){this.#k=e}finally{this.#e--,0==this.#e&&(this.invalidate(),this.dispatchEvent(new Event("loaded")),coenv.leaveLoading())}}destroy(){this.#C&&(this.#C.destroy(),this.#C=null)}onMount(){}onUnmount(){}#R;listen(e,t,n){e&&t&&(n||(n=this.invalidate),this.#R||(this.#R=[]),this.#R.push({target:e,event:t,handler:n}),this.#u&&e.addEventListener(t,n))}unlisten(e,t,n){if(!e||!t||!this.#R)return;let i=this.#R.findIndex((i=>i.target==e&&i.event==t&&i.handler==n));i>=0&&(this.#R.splice(i,1),this.#u&&e.removeEventListener(t,n))}get mounted(){return this.#u}#u=!1;setMounted(e){this.#C?.setMounted(e),this.#u=e;let t=!1;e&&this.#R&&(this.#R.forEach((e=>e.target.addEventListener(e.event,e.handler))),t=this.#R.length>0&&this.#C),e?this.onMount():this.onUnmount(),t&&this.invalidate(),!e&&this.#R&&this.#R.forEach((e=>e.target.removeEventListener(e.event,e.handler)))}mount(e){coenv.mount(this,e)}unmount(){coenv.unmount(this)}static template={}}const j={entering:"*-entering;*-active","enter-start":"*-enter-start;*-out","enter-end":"*-enter-end;*-in",leaving:"*-leaving;*-active","leave-start":"*-leave-start;*-in","leave-end":"*-leave-end;*-out"};function I(e,t){let n,i,o=[],s=[],r=[],a=!1,l=!1,d=!1;function h(e){return e instanceof Function?e(t.model,t):e}h(e.name);let c=h(e.mode),u=h(e.clasNames),m=h(e.duration),p=h(e.subtree);switch(c){case"enter-leave":case"leave-enter":break;default:c=""}function f(t){let n=[];for(let i of t){let t=u?.[i]??j[i];t=(t??"").split(";"),t=t.map((t=>t.replace(/\*/g,e.name??"tx"))),n.push(...t)}return n}function g(e,t){let n=f(t);n.length&&e.forEach((e=>e.classList?.add(...n)))}function v(e,t){let n=f(t);n.length&&e.forEach((e=>e.classList?.remove(...n)))}function y(e,t,n){requestAnimationFrame((()=>requestAnimationFrame((()=>{g(e,[t]),v(e,[n])})))),r.push(...e)}function w(){l=!0,g(o,["entering","enter-start"]),n?.(),n=null,y(o,"enter-end","enter-start")}function $(){l=!1,v(o,["enter-start","entering","enter-end"])}function b(){d=!0,g(s,["leaving","leave-start"]),y(s,"leave-end","leave-start")}function x(){d=!1,v(s,["leave-start","leaving","leave-end"]),i?.(),i=null}function N(e){if(void 0!==m){let e=0;return l&&(e=e[0]),d&&(e=Math.max(e,e[1])),new Promise((t=>setTimeout(t,e)))}return new Promise(((e,t)=>{requestAnimationFrame((()=>requestAnimationFrame((()=>{requestAnimationFrame((()=>{let t=[];for(let e of r)1==e.nodeType&&t.push(...e.getAnimations({subtree:p??!0}));r=[],Promise.allSettled(t.map((e=>e.finished))).then(e)}))}))))}))}return null==m||Array.isArray(m)||(m=[m,m]),{enterNodes:function(e){o.push(...e)},leaveNodes:function(e){s.push(...e)},onWillEnter:function(e){n=e},onDidLeave:function(e){i=e},start:async function(){e.on_start?.(t.model,t),""!=c&&"enter-leave"!=c||w(),""!=c&&"leave-enter"!=c||b(),await N(),a||(""!=c?("enter-leave"==c?(b(),$()):"leave-enter"==c&&(w(),x()),await N(),"enter-leave"==c?x():"leave-enter"==c&&$()):($(),x()),a=!0,e.on_finish?.(t.model,t))},finish:function(){a||(a=!0,n?.(),$(),x(),e.on_cancel?.(t.model,t))}}}function U(...e){let t={};for(let n=0;n<e.length;n++){let i=e[n];if(i instanceof Function)t.value=i;else if("string"==typeof i)t.name=i;else{if("object"!=typeof i)throw new Error("Invalid argument to transition");Object.assign(t,i)}}e=t;let n=function(){return e.value(...arguments)};return n.withTransition=function(t){return e.type?new e.type(e,t):I(e,t)},n}class q{constructor(e){this.$node={type:e}}append(...e){e=e.flat(1e3).map((e=>e.$node??e)),this.$node.$?this.$node.$.push(...e):this.$node.$=[...e]}attr(e,t){if(("class"==e||"style"==e)&&arguments.length>2?(e=`${e}_${t}`,t=arguments[2]):"on"==e&&arguments.length>2?(e=`on_${t}`,t=arguments[2]):"type"==e&&(e="attr_type"),void 0!==this.$node[e])throw new Error(`duplicate attribute: ${e}`);this.$node[e]=t}}let P={get:function(e,t){if("bind"!=t&&"name"!=t){let n=Reflect.get(e,t);if(void 0!==n)return n}return(...n)=>(Reflect.get(e,"$tb").attr(t,...n),Reflect.get(e,"$proxy"))}},B={get:function(e,t){let n=Reflect.get(e,t);return void 0!==n?n:V(t)}};function V(e){let t,n=new q(e),i=function(){return n.append(...arguments),t};return i.$tb=n,i.$node=n.$node,t=new Proxy(i,P),i.$proxy=t,t}V.html=d,V.encode=b;let W=new Proxy(V,B);function z(){let e=new WeakMap,t=new Map;function n(n){return n instanceof Object?e:t}function i(e){if(!e)return;let t=n(e).get(e);if(t)for(let e=t.length-1;e>=0;e--)t[e].apply(null,arguments)}return i.addEventListener=function(e,t){if(!e)return;let i=n(e),o=i.get(e);o?o.push(t):o=i.set(e,[t])},i.removeEventListener=function(e,t){if(!e)return;let i=n(e).get(e);if(i){let e=i.indexOf(t);e>=0&&i.splice(e,1)}},i}let J=new z;class H extends r{constructor(){super(),this.browser=!0,this.document=document,this.window=window,this.hydrateMounts=document.head.querySelector("meta[name='co-ssr']")?[]:null,this.pendingStyles=""}declareStyle(e){e.length>0&&(this.pendingStyles+="\n"+e,this.hydrateMounts||this.window.requestAnimationFrame((()=>this.mountStyles())))}mountStyles(){0!=this.pendingStyles.length&&(this.styleNode||(this.styleNode=document.createElement("style")),this.styleNode.innerHTML+=this.pendingStyles+"\n",this.pendingStyles="",this.styleNode.parentNode||document.head.appendChild(this.styleNode))}doHydrate(){g((async()=>{for(;await this.untilLoaded(),y();)await new Promise((e=>v(e)));v((()=>{document.querySelectorAll(".cossr").forEach((e=>e.remove()));let e=this.hydrateMounts;this.hydrateMounts=null,e.forEach((e=>{K(e.el),this.mount(e.component,e.el)})),K(document.head),this.mountStyles()}))}),Number.MAX_SAFE_INTEGER)}mount(e,t){"string"==typeof t&&(t=document.querySelector(t)),this.hydrateMounts?(this.hydrateMounts.push({el:t,component:e}),1==this.hydrateMounts.length&&this.doHydrate()):(t.append(...e.rootNodes),e.setMounted(!0))}unmount(e){e.created&&e.rootNodes.forEach((e=>e.remove())),e.setMounted(!1)}async fetchTextAsset(e){let t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch '${e}': ${t.status} ${t.statusText}`);return t.text()}}if("undefined"!=typeof document){let e=new H;a((()=>e))}function K(e){let t=e.firstChild,n=!1;for(;t;){let e=t.nextSibling;8==t.nodeType&&"co-ssr-start"==t.data&&(n=!0),n&&t.remove(),8==t.nodeType&&"co-ssr-end"==t.data&&(n=!1),t=e}}function G(e){let t,n="^",i=e.length;for(let s=0;s<i;s++){t=!0;let r=e[s];if("?"==r)n+="[^\\/]";else if("*"==r)n+=s+1==i?"(?<tail>.*)":"[^\\/]+";else if(":"==r){s++;let r=s;for(;s<i&&o(e[s]);)s++;let a=e.substring(r,s);if(0==a.length)throw new Error("syntax error in url pattern: expected id after ':'");let l="[^\\/]+";if("("==e[s]){s++,r=s;let t=0;for(;s<i;){if("("==e[s])t++;else if(")"==e[s]){if(0==t)break;t--}s++}if(s>=i)throw new Error("syntax error in url pattern: expected ')'");l=e.substring(r,s),s++}if(s<i&&"*"==e[s]||"+"==e[s]){let i=e[s];s++,"/"==e[s]?(n+=`(?<${a}>(?:${l}\\/)${i})`,s++):n+="*"==i?`(?<${a}>(?:${l}\\/)*(?:${l})?\\/?)`:`(?<${a}>(?:${l}\\/)*(?:${l})\\/?)`,t=!1}else n+=`(?<${a}>${l})`;s--}else"/"==r?(n+="\\"+r,s==e.length-1&&(n+="?")):".$^{}[]()|*+?\\/".indexOf(r)>=0?(n+="\\"+r,t="/"!=r):n+=r}return t&&(n+="\\/?"),n+="$",n;function o(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"==e||"$"==e}}class Z{constructor(e){this.#A=Object.assign({max:10},e)}#D=[];#A;get(e,t){e instanceof URL&&(e=e.pathname+e.query);for(let t=0;t<this.#D.length;t++){let n=this.#D[t];if(n.key==e)return t>0&&(this.#D.splice(t,1),this.#D.unshift(n)),n.page}let n={key:e,page:t(e)};return this.#D.unshift(n),this.#D.length>this.#A.max&&this.#D.splice(this.#D),n.page}}class X{static get(){return{top:coenv.window.pageYOffset||coenv.document.documentElement.scrollTop,left:coenv.window.pageXOffset||coenv.document.documentElement.scrollLeft}}static set(e){e?coenv.window.scrollTo(e.left,e.top):coenv.window.scrollTo(0,0)}}class Y{constructor(e){this.#O=e,coenv.window.history.scrollRestoration&&(coenv.window.history.scrollRestoration="manual");let t=coenv.window.sessionStorage.getItem("codeonly-view-states");t&&(this.#F=JSON.parse(t)),e.addEventListener("mayLeave",((e,t)=>(this.captureViewState(),!0))),e.addEventListener("mayEnter",((e,t)=>{"push"!=t.navMode&&(t.viewState=this.#F[t.state.sequence])})),e.addEventListener("didEnter",((e,t)=>{if("push"==t.navMode){for(let e of Object.keys(this.#F))parseInt(e)>t.state.sequence&&delete this.#F[e];this.saveViewStates()}s(coenv,(()=>{g((()=>{t.handler.restoreViewState?t.handler.restoreViewState(t.viewState,t):this.#O.restoreViewState?this.#O.restoreViewState?.(t.viewState,t):X.set(t.viewState);{let e=document.getElementById(t.url.hash.substring(1));e?.scrollIntoView()}}))}))})),coenv.window.addEventListener("beforeunload",(e=>{this.captureViewState()}))}#O;#F={};captureViewState(){let e=this.#O.current;e&&(e.handler.captureViewState?this.#F[e.state.sequence]=e.handler.captureViewState(e):this.#O.captureViewState?this.#F[e.state.sequence]=this.#O.captureViewState?.(e):this.#F[e.state.sequence]=X.get()),this.saveViewStates()}saveViewStates(){coenv.window.sessionStorage.setItem("codeonly-view-states",JSON.stringify(this.#F))}}class Q{async start(e){this.#O=e,new Y(e),coenv.document.body.addEventListener("click",(e=>{if(e.defaultPrevented)return;let t=e.target.closest("a");if(t){if(t.hasAttribute("download"))return;let n=t.getAttribute("href"),i=new URL(n,coenv.window.location);if(i.origin==coenv.window.location.origin){try{i=this.#O.internalize(i)}catch{return}return this.navigate(i).then((e=>{null==e&&(window.location.href=n)})),e.preventDefault(),!0}}})),coenv.window.addEventListener("popstate",(async e=>{if(this.#j)return void(this.#j=!1);let t=this.#I+1,n=this.#O.internalize(new URL(coenv.window.location)),i=e.state??{sequence:this.current.state.sequence+1};await this.load(n,i,{navMode:"pop"})||t==this.#I&&(this.#j=!0,coenv.window.history.go(this.current.state.sequence-i.sequence))}));let t=this.#O.internalize(new URL(coenv.window.location)),n=coenv.window.history.state??{sequence:0},i=await this.load(t,n,{navMode:"start"});return coenv.window.history.replaceState(n,null),i}#I=0;#O;#j=!1;get current(){return this.#O.current}async load(e,t,n){return this.#I++,await this.#O.load(e,t,n)}back(){if(0==this.current.state.sequence){let e=new URL("/",this.#O.internalize(new URL(coenv.window.location))),t={sequence:0};coenv.window.history.replaceState(t,"",this.#O.externalize(e)),this.load(e,t,{navMode:"replace"})}else coenv.window.history.back()}replace(e){"string"==typeof e&&(e=new URL(e,this.#O.internalize(new URL(coenv.window.location)))),void 0!==e&&(this.current.pathname=e.pathname,this.current.url=e,e=this.#O.externalize(e).href),coenv.window.history.replaceState(this.current.state,"",e)}async navigate(e){"string"==typeof e&&(e=new URL(e,this.#O.internalize(new URL(coenv.window.location))));let t=await this.load(e,{sequence:this.current.state.sequence+1},{navMode:"push"});return t?(coenv.window.history.pushState(t.state,"",this.#O.externalize(e)),t):t}}class ee{constructor(e){e&&this.register(e)}start(e){if(!this.#U)return e||(e=new Q),this.#U=e,e&&(this.navigate=e.navigate.bind(e),this.replace=e.replace.bind(e),this.back=e.back.bind(e)),this.#U.start(this)}urlMapper;#U;#q(e,t){return this.urlMapper?e instanceof URL?this.urlMapper[t](e):this.urlMapper[t](new URL(e,"http://x/")).href.substring(8):e instanceof URL?new URL(e):e}urlMapper;internalize(e){return this.#q(e,"internalize")}externalize(e){return this.#q(e,"externalize")}#P={c:null,p:null,l:[]};get#B(){return this.#U?.state??this.#P}get#V(){return this.#B.c}set#V(e){this.#B.c=e}get#W(){return this.#B.p}set#W(e){this.#B.p=e}get#R(){return this.#B.l}get current(){return this.#V}get pending(){return this.#W}addEventListener(e,t){this.#R.push({event:e,handler:t})}removeEventListener(e,t){let n=this.#R.findIndex((n=>n.event==e&&n.handler==t));n>=0&&this.#R.splice(n,1)}async dispatchEvent(e,t,n,i){for(let o of this.#R)if(o.event==e){let e=o.handler(n,i);if(t&&0==await Promise.resolve(e))return!1}return!0}async load(e,t,n){return coenv.load((async()=>{n=n??{};let i=this.#V;if(this.#V?.url.pathname==e.pathname&&this.#V.url.search==e.search){let e=this.#V.handler.hashChange?.(this.#V,n);n=void 0!==e?e:Object.assign({},this.#V,n)}if(n=Object.assign(n,{current:!1,url:new URL(e),state:t}),this.#W=n,!n.match&&!(n=await this.matchUrl(e,t,n)))return null;try{!0!==await this.tryLoad(n)&&(this.#W=null)}catch(e){throw this.dispatchCancelEvents(i,n),e}return this.#W!=n?(this.dispatchCancelEvents(i,n),null):(this.#W=null,n)}))}dispatchCancelEvents(e,t){this.#V?.handler.cancelLeave?.(e,t),t.handler.cancelEnter?.(e,t),this.dispatchEvent("cancel",!1,e,t)}async tryLoad(e){let t,n=this.#V;if(n){if(!await this.dispatchEvent("mayLeave",!0,n,e))return;if(e!=this.#W)return;if(t=n.handler.mayLeave?.(n,e),!1===await Promise.resolve(t))return;if(e!=this.#W)return}if(t=e.handler.mayEnter?.(n,e),!1!==await Promise.resolve(t)&&e==this.#W&&await this.dispatchEvent("mayEnter",!0,n,e)&&e==this.#W)return n&&(n.current=!1),e.current=!0,this.#V=e,n&&(this.dispatchEvent("didLeave",!1,n,e),n?.handler.didLeave?.(n,e)),e.handler.didEnter?.(n,e),this.dispatchEvent("didEnter",!1,n,e),!0}async matchUrl(e,t,n){this.#z&&(this.#J.sort(((e,t)=>(e.order??0)-(t.order??0))),this.#z=!1);for(let e of this.#J)if(!e.pattern||(n.match=n.url.pathname.match(e.pattern),n.match)){if(!e.match)return n.handler=e,n;{let t=await Promise.resolve(e.match(n));if(!0===t||t==n)return n.handler=e,n;if(null===t)return null}}return n.handler={},n}#J=[];#z=!1;register(e){Array.isArray(e)||(e=[e]);for(let t of e)"string"==typeof t.pattern&&(t.pattern=new RegExp(G(t.pattern))),this.#J.push(t);this.#z=!0}revoke(e){this.#J=this.#J.filter((t=>!e(t)))}captureViewState;restoreViewState}let te=new ee;class ne{constructor(e){if(this.#A=e,this.#A.base&&(!this.#A.base.startsWith("/")||!this.#A.base.endsWith("/")))throw new Error(`UrlMapper base '${this.#A.base}' must start and end with '/'`)}#A;internalize(e){if(this.#A.base){if(!e.pathname.startsWith(this.#A.base))throw new Error(`Can't internalize url '${e}'`);(e=new URL(e)).pathname=e.pathname.substring(this.#A.base.length-1)}if(this.#A.hash){if("/"!=e.pathname)throw new Error(`can't internalize url "${e.href}"`);let t=e.hash.substring(1);t.startsWith("/")||(t="/"+t),e=new URL(`${e.origin}${t}`)}return e}externalize(e,t){return!t&&this.#A.hash&&(e=new URL(`${e.origin}/#${e.pathname}${e.search}${e.hash}`)),this.#A.base&&((e=new URL(e)).pathname=this.#A.base.slice(0,-1)+e.pathname),e}}async function ie(e){if(!e.startsWith("/"))throw new Error("asset paths must start with '/'");if(te.urlMapper){let t=new URL(e,new URL(coenv.window.location));t=te.urlMapper.externalize(t,!0),e=t.pathname+t.search}return coenv.fetchTextAsset(e)}async function oe(e){return JSON.parse(await ie(e))}export{W as $,H as BrowserEnvironment,h as CloakedValue,F as Component,X as DocumentScrollPosition,r as Environment,l as HtmlString,z as Notify,Z as PageCache,ee as Router,u as Style,I as TransitionCss,ne as UrlMapper,Y as ViewStateRestoration,Q as WebHistoryRouterDriver,y as anyPendingFrames,c as cloak,O as compileTemplate,m as css,oe as fetchJsonAsset,ie as fetchTextAsset,d as html,b as htmlEncode,x as input,g as nextFrame,J as notify,v as postNextFrame,te as router,a as setEnvProvider,U as transition,G as urlPattern};
